buildscript {
    repositories {
        jcenter()
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:2.3.3'
        classpath 'me.tatarka:gradle-retrolambda:3.3.0'
        classpath 'me.tatarka.retrolambda.projectlombok:lombok.ast:0.2.3.a2'
        classpath 'de.felixschulze.gradle:gradle-hockeyapp-plugin:3.5'
    }

    // Exclude the version that the android plugin depends on.
    configurations.classpath.exclude group: 'com.android.tools.external.lombok'
}

allprojects {
    repositories {
        jcenter()
    }
}

ext {
    projectName = 'Template'
    hockeyAppId = '"00000000000000000000000000000000"'
    versionName = gitVersionName
    versionCode = gitVersionCode
    versionHash = gitRefHash
}

def getGitVersionName() {
    def tag = 'git describe --tags'.execute().text.split('-').first()?.trim()
    if (tag =~ /^v.*$/) {
        return tag.substring(1, tag.lastIndexOf(".")) // exclude build number
    }
    return '1.0.0'
}

def getGitRefHash() {
    return 'git rev-parse HEAD'.execute().text.substring(0, 8)
}

// if there was a previous version in play store put here a value to make automatically generated version codes higher
def getOldStoreVersionCode() {
    return 0;
}

// generates version code from x.y.y.z version name where x.y.y is customer defined version and z is build number
int getGitVersionCode() {
    def versionCode = 0
    (gitTagName =~ /(\d+)/).collect {
        Integer.parseInt(it[0] as String)
    }.eachWithIndex { num, index ->
        versionCode *= 10 // each multiplication by 10 adds a digit to 'y' and 'z' places in x.y.y.z
        versionCode += num
        if (index == 2) {
            versionCode *= 10 // each multiplication by 10 adds a digit to 'z' places in x.y.y.z
        }
    }
    return versionCode + getOldStoreVersionCode();
}

String getGitTagName() {
    def tag = 'git describe --tags'.execute().text.split('-').first()?.trim()
    if (tag =~ /^v.*$/) {
        return tag.substring(1)
    }
    return '1.0.0.0'
}